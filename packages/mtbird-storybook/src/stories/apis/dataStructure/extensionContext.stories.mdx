import { Meta } from "@storybook/addon-docs";
import LinkTo from "@storybook/addon-links/react";

<Meta title="APIs/æ•°æ®ç»“æ„/æ‹“å±•ä¸Šä¸‹æ–‡" parameters={{ viewMode: "docs" }} />

# æ‹“å±•ä¸Šä¸‹æ–‡ ExtensionContext

TS Type: IExtensionContext

## ç»“æ„

```typescript
export interface IExtensionContext {
  page: IPageConfig | null;
  componentMap: Map<string, IComponentInstance | IComponentInstanceForm>;
  currentComponent: IComponentInstance[];
  request: IRequest;
  storage: Storage;
  router: IRouter;

  // event emit and subscription hub
  eventHub: IEventEmitter;
  EVENT_KEYS: Record<string, Symbol>;

  /**
   * ç¼–è¾‘å™¨æ‰€æœ‰å·²æ³¨å†Œçš„ç»„ä»¶
   */
  registeredComponents?: Record<string, IComponentCommon>;

  /**
   * æ³¨å†Œfeature
   */
  registerFeature: (key: string, feature: any) => void;
  /**
   * æ³¨å†Œå¼¹çª—
   */
  registerModal: (key: string, modal: any) => void;
  /**
   * æ·»åŠ ç»„ä»¶
   */
  addComponent: (component: IComponentInstance) => void;
  /**
   * åˆ é™¤ç»„ä»¶
   */
  deleteComponent: () => void;
  /**
   * å¤åˆ¶ç»„ä»¶
   */
  copyComponent: () => void;
  /**
   * ç§»åŠ¨ç»„ä»¶
   */
  moveComponent: (leftOffset: number, topOffset: number) => void;
  /**
   * ä¸Šç§»ä¸€å±‚
   */
  goUpper: () => void;
  /**
   * ä¸‹ç§»ä¸€å±‚
   */
  goLower: () => void;

  /**
   * é€‰ä¸­ç»„ä»¶
   */
  selectComponent: (component: Array<IComponentInstance>) => void;

  /**
   * modify currentComponent config
   */
  onChangeValue: (keyPath: string, value: any) => void;

  /**
   * Inject render pipe handler and configuration into currentComponent's pipes.render attribute
   */
  injectRenderPipe: (extensionName: string, pipeName: string) => void;

  /**
   * Remove render pipe handler and configuration from currentComponent's pipes.render attribute
   */
  removeRenderPipe: (extensionName: string, pipeName: string) => void;
}
```

## å±æ€§

### ğŸ’ page

å½“å‰ç¼–è¾‘å™¨æ­£åœ¨æ“ä½œçš„é¡µé¢ï¼Œä¸º IPageConfig ç±»å‹ï¼Œå…·ä½“æ•°æ®ç»“æ„å‚è€ƒï¼šé¡µé¢ Page

### ğŸ’ currentComponent

å½“å‰ç¼–è¾‘å™¨æ­£åœ¨æ“ä½œçš„ç»„ä»¶ï¼Œä¸ºå•ä¸ªç»„ä»¶å¯¹è±¡ï¼Œæˆ–ç»„ä»¶å¯¹è±¡æ•°ç»„ï¼ˆå½“å‰å¤šé€‰ï¼‰ï¼Œç»„ä»¶ç±»å‹ä¸º IComponentInstance ï¼Œå…·ä½“æ•°æ®ç»“æ„å¯ä»¥å‚è€ƒï¼šç»„ä»¶ Component

### ğŸ’ request

æ•°æ®è¯·æ±‚æ“ä½œå¯¹è±¡

### ğŸ’ storage

æ•°æ®å­˜å‚¨æ“ä½œå¯¹è±¡ï¼ŒAPI ç±»ä¼¼ localStorage

### ğŸ’ router

è·¯ç”±æ“ä½œå¯¹è±¡

### ğŸ’ eventHub

ç¼–è¾‘å™¨å…¨å±€äº‹ä»¶å

## æ–¹æ³•

### ğŸ”§ addComponent æ·»åŠ ç»„ä»¶

å‘æ­£åœ¨ç¼–è¾‘çš„é¡µé¢ä¸­æ·»åŠ ç»„ä»¶ï¼Œå¦‚æœå½“å‰é€‰ä¸­ç»„ä»¶ç±»å‹ä¸º containerï¼Œåˆ™åŠ å…¥å½“å‰é€‰ä¸­ç»„ä»¶ä¸­ï¼Œå¦åˆ™ï¼Œåˆ™åŠ å…¥åˆ°å½“å‰é€‰ä¸­ç»„ä»¶çš„çˆ¶ç»„ä»¶ä¸­ã€‚
ç±»å‹

```typescript
(component: IComponentInstance) => void;
```

å‚æ•°

- componentï¼šéœ€è¦æ·»åŠ çš„ç»„ä»¶ï¼Œç±»å‹ä¸º ç»„ä»¶ Component

### ğŸ”§ deleteComponent åˆ é™¤ç»„ä»¶

åˆ é™¤å½“å‰é€‰ä¸­ï¼ˆcurrentComponentï¼‰ç»„ä»¶
ç±»å‹

```typescript
() => void;
```

### ğŸ”§ copyComponent å¤åˆ¶ç»„ä»¶

å¤åˆ¶å½“å‰é€‰ä¸­ï¼ˆcurrentComponentï¼‰ç»„ä»¶
ç±»å‹

```typescript
() => void;
```

### ğŸ”§ moveComponent ç§»åŠ¨ç»„ä»¶

ç§»åŠ¨å½“å‰é€‰ä¸­ï¼ˆcurrentComponentï¼‰ç»„ä»¶
ç±»å‹

```typescript
(leftOffset: number, topOffset: number) => void;
```

### ğŸ”§ goUpper ä¸Šç§»ä¸€å±‚

å°†å½“å‰é€‰ä¸­ï¼ˆcurrentComponentï¼‰ç»„ä»¶ï¼Œä¸Šç§»ä¸€å±‚
ç±»å‹

```typescript
() => void;
```

### ğŸ”§ goLower ä¸‹ç§»ä¸€å±‚

å°†å½“å‰é€‰ä¸­ï¼ˆcurrentComponentï¼‰ç»„ä»¶ï¼Œä¸‹ç§»ä¸€å±‚
ç±»å‹

```typescript
() => void;
```

### ğŸ”§ selectComponent é€‰ä¸­ç»„ä»¶

é€‰æ‹©æŸä¸€ç»„ä»¶

ç±»å‹

```typescript
(component: Array<IComponentInstance>) => void;
```

### ğŸ”§ onChangeValue ä¿®æ”¹å½“å‰ç»„ä»¶é…ç½®

ä¿®æ”¹å½“å‰é€‰æ‹©ç»„ä»¶çš„å±æ€§ï¼Œå¦‚æœå½“å‰é€‰ä¸­å¤šä¸ªï¼Œåˆ™æ¯ä¸€ä¸ªç»„ä»¶çš„ keyPath å±æ€§éƒ½ä¼šè¢«èµ‹å€¼æˆ value

ç±»å‹

```typescript
(keyPath: string, value: any) => void;
```

### ğŸ”§ injectRenderPipe æ³¨å…¥æ¸²æŸ“ç®¡çº¿

æ³¨å…¥æ¸²æŸ“ç®¡çº¿ï¼Œç®¡çº¿åéœ€åœ¨ manifest.json é…ç½®æ–‡ä»¶ä¸­å£°æ˜ï¼Œå¹¶åœ¨ src/pipes/{pipeName}.ts æ–‡ä»¶ä¸­å®šä¹‰

ç±»å‹

```typescript
(extensionName: string, pipeName: string) => void;
```

### ğŸ”§ removeRenderPipe ç§»é™¤æ¸²æŸ“ç®¡çº¿

ç§»é™¤æ¸²æŸ“ç®¡çº¿åœ¨å½“å‰ç»„ä»¶ä¸­çš„åº”ç”¨

ç±»å‹
(extensionName: string, pipeName: string) => void;

### ğŸ”§ registerFeature

å‚æ•°

- key: ç»„ä»¶å”¯ä¸€æ ‡è¯†ï¼ˆä¼šé»˜è®¤åŠ ä¸Šæ‹“å±•åä½œä¸ºå‰ç¼€ï¼Œä»¥æ–¹å¼æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚å¦‚è·¨æ‹“å±•è°ƒç”¨ç»„ä»¶ï¼Œéœ€åœ¨ç»„ä»¶å‰åŠ ä¸Šæ‹“å±•åç§°ï¼‰
- feature: React ç»„ä»¶ï¼ˆè¿™ä¸ª React ç»„ä»¶ä¸­ï¼Œä¹Ÿä¼šä»¥ props å½¢å¼ä¼ å…¥ä¸€ä¸ª context å…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰

å°†æŸä¸€ä¸ª React ç»„ä»¶æ³¨å†Œä¸ºå¯ä¾›ç¼–è¾‘å™¨ä½¿ç”¨çš„æ‹“å±•ç»„ä»¶

ä½¿ç”¨æ¡ˆä¾‹

åœ¨ manifest.json

```json
...
"contributes": {
"toolbars": [
{
"params": {
"name": "æ‹“å±•æ¡ˆä¾‹"
},
"link": "component",
"component": "example.tab" // component key
}
]
}
...
```

### ğŸ”§ registerModal

**_[å‚æ•°]_**

- key: ç»„ä»¶å”¯ä¸€æ ‡è¯†ï¼ˆä¼šé»˜è®¤åŠ ä¸Šæ‹“å±•åä½œä¸ºå‰ç¼€ï¼Œä»¥æ–¹å¼æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚å¦‚è·¨æ‹“å±•è°ƒç”¨ç»„ä»¶ï¼Œéœ€åœ¨ç»„ä»¶å‰åŠ ä¸Šæ‹“å±•åç§°ï¼‰
- modal: React ç»„ä»¶ï¼ˆè¿™ä¸ª React ç»„ä»¶ä¸­ï¼Œä¹Ÿä¼šä»¥ props å½¢å¼ä¼ å…¥ä¸€ä¸ª context å…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰

æ³¨å†Œä¸€ä¸ªå…¨å±€æ¨¡æ€æ¡†
ä½¿ç”¨æ¡ˆä¾‹

åœ¨ manifest.json

```json
...
"contributes": {
  "toolbars": [
    {
      "params": {
        "name": "æ‹“å±•æ¡ˆä¾‹"
      },
      "link": "modal",
      "modal": "example.tab" // component key
    }
  ]
}
...
```
