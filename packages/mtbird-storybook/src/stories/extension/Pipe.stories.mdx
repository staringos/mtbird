import { Meta } from '@storybook/addon-docs';
import LinkTo from '@storybook/addon-links/react';

<Meta title="æ‹“å±•/Pipe(æ¸²æŸ“ç®¡çº¿)" parameters={{ viewMode: 'docs' }} />

# æ¸²æŸ“ç®¡çº¿ Pipe

æ‹“å±•ç›®å‰å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸‰ç§èƒ½åŠ›çš„å¢å¼ºï¼Œåˆ†åˆ«æ˜¯ contributesï¼ˆç¼–è¾‘å™¨è´¡çŒ®ï¼‰ã€pipesï¼ˆæ¸²æŸ“ç®¡çº¿ï¼‰ã€componentsï¼ˆä¸šåŠ¡ç»„ä»¶ï¼‰

æ¸²æŸ“ç®¡çº¿æ˜¯å¸®åŠ©æˆ‘ä»¬æ‹“å±•æ¸²æŸ“å™¨ `@mtbird/render-web` åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¹‹å‰ç»å¸¸ä½¿ç”¨çš„ `contribute` ç†è§£ä¸ºé’ˆå¯¹ç¼–è¾‘å™¨åŠŸèƒ½çš„æ‹“å±•ï¼Œè€Œé’ˆå¯¹æŸäº›éœ€è¦åœ¨æ¸²æŸ“å±‚å¤„ç†çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¸²æŸ“ç®¡çº¿è¿›è¡Œå¤„ç†ã€‚

æ¸²æŸ“ç®¡çº¿åœ¨æ‹“å±•ä¸­æ˜¯ä½äº `src/pipes` æ–‡ä»¶å¤¹ä¸‹çš„ç‹¬ç«‹æ–‡ä»¶ï¼Œè·Ÿ contributes ä¸€æ ·ï¼Œä¹Ÿéœ€è¦åœ¨ `manifest.json` æ–‡ä»¶ä¸­å£°æ˜ï¼Œæ¡ˆä¾‹å¯ä»¥å‚è€ƒ `mtbird/packages/mtbird-extension-animation`

## ğŸŒ° ä¾‹å­

æ¯”å¦‚æˆ‘ä»¬åœ¨åŠ¨ç”»æ‹“å±•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸ [animate.css](https://animate.style/) ç»“åˆã€‚åœ¨ç¼–è¾‘å™¨ä¸­è®°å½•ç”¨æˆ·é€‰æ‹©çš„ åŠ¨ç”»ç±»å‹ã€å»¶è¿Ÿæ—¶é—´ã€æŒç»­æ—¶é—´ ç­‰å±æ€§ï¼Œå¹¶éœ€è¦åœ¨æ¸²æŸ“å±‚å°†è¿™äº›å±æ€§è½¬åŒ–ä¸º [animate.css](https://animate.style/) çš„ css æ ·å¼ï¼Œå¹¶èµ‹äºˆç»™æœ€ç»ˆæ¸²æŸ“å®Œæˆçš„ dom å…ƒç´ ã€‚

## åˆ›å»ºæ¸²æŸ“ç®¡çº¿

åœ¨ `src/pipes` ä¸­ï¼Œå¢åŠ  `animate.ts` æ–‡ä»¶

```typescript
export default (params: { node: IComponentInstance }) => {
  const { animate } = node;
  // å¦‚æœæœ‰ delay å±æ€§ï¼Œå°±å¢åŠ  animate.css å¤„ç† delay çš„æ–¹æ³•
  if (animate.delay) {
    node.props.className = node.props.className + ` animate__delay-${animate.delay}s`;
  }
};
```

## å¢åŠ  pipes é…ç½®

åœ¨ manifest.json æ–‡ä»¶ä¸­ï¼Œå£°æ˜ pipe

```json
{
  ...
  "pipes": ["animate"],
  ...
}
```

## åœ¨ Features æ³¨å…¥ pipe

é€šè¿‡ context.injectRenderPipe æ–¹æ³•å°† pipe æ³¨å…¥åˆ°å½“å‰é€‰ä¸­ç»„ä»¶ä¸­ï¼Œé€šè¿‡ context.removeRenderPipe æ¸…é™¤ç»„ä»¶çš„ pipe

```tsx
const AnimatePanel = ({ context }) => {
  ...
  const handleToggleAnimate = (e: boolean) => {
    context.onChangeValue('pattern.animate.open', e);
    if (e) {
      context.injectRenderPipe(manifest.name, 'animate');
    } else {
      context.removeRenderPipe(manifest.name, 'animate');
    }
  };

  return (
    <div className={styles.animationPanel}>
      <div className={styles.animationHeader}>
        <span className={styles.label}>å¼€å¯åŠ¨ç”»</span>
        <Switch checked={currentAni.open} onChange={handleToggleAnimate} />
      </div>
      ...
    </div>
  )
};
```

æ³¨å…¥åï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œæ¸²æŸ“å™¨ä¼šè°ƒç”¨ pipeï¼Œå¹¶å°†æ‰§è¡Œç»“æœç”¨äºæ¸²æŸ“é¡µé¢ã€‚

## æ³¨æ„äº‹é¡¹

- æ¯ä¸€ä¸ªæ¸²æŸ“ç®¡çº¿éœ€è¦æ˜¯åŒæ­¥çš„çº¯æ–¹æ³•ï¼šä¸èƒ½ä½¿ç”¨ `async` å’Œ `promise` ä¿è¯æ¸²æŸ“ä¸è¢«é˜»å¡ã€‚
- å°½é‡ä¿è¯å°‘æˆ–è€…é›¶å¤–éƒ¨ä¾èµ–ï¼šä¸ºæ€§èƒ½è€ƒè™‘ï¼Œæ¯ä¸€ä¸ª pipe ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼Œåœ¨æ¸²æŸ“æ—¶åŠ¨æ€è¿œç¨‹è°ƒç”¨ã€‚

å…³äºæ¸²æŸ“ç®¡çº¿çš„è®¾è®¡æ€æƒ³ï¼Œå¯ä»¥å‚è€ƒï¼šå…ƒç¼–ç¨‹æ¸²æŸ“ç®¡çº¿

ä¸‹ä¸€ç¯‡ï¼š<LinkTo kind="æ‹“å±•-component-è‡ªå®šä¹‰ç»„ä»¶--page">è‡ªå®šä¹‰ç»„ä»¶(Component)</LinkTo>
